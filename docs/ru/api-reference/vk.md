# VK

```js
import VK from 'vk-io';

// OR

import { VK } from 'vk-io';
```

## Constructor
Инициализация новой инстанции
```js
new VK([options]);
```

Например
```js
new VK({
	app: 1707
});
```

| Параметр | Тип    | Описание          |
|----------|--------|-------------------|
| options  | Object | [Опции](#options) |

## setOptions
Устанавливает опции

```js
vk.setOptions(options); // => this
```

| Параметр | Тип    | Описание          |
|----------|--------|-------------------|
| options  | Object | [Опции](#options) |

## Options
### Общие опции

| Опция | Тип    | Описание                                                                 | По умолчанию |
|-------|--------|--------------------------------------------------------------------------|--------------|
| token | string | Токен                                                                    | null         |
| agent | Agent  | [HTTPS агент](https://nodejs.org/api/https.html#https_class_https_agent) | https.Agent  |
| lang  | string | Язык возвращаемых данных                                                 | null         |

Доступные языки возвращаемых данных
- `ru` - русский
- `ua` - украинский
- `be` - белорусский
- `en` - английский
- `es` - испанский
- `fi` - финский
- `de` - немецкий
- `it` - итальянский

### Опции авторизации

| Опция    | Тип    | Описание                  | По умолчанию |
|----------|--------|---------------------------|--------------|
| login    | string | Логин (email)             | null         |
| phone    | string | Телефон                   | null         |
| password | string | Пароль                    | null         |
| app      | number | Идентификатор приложения  | null         |
| key      | string | Секретный ключ приложения | null         |
| scope    | string | Доступ приложения         | all          |

### Опции запросов к API

| Опция             | Тип      | Описание                                                                  | По умолчанию                                                             |
|-------------------|----------|---------------------------------------------------------------------------|--------------------------------------------------------------------------|
| apiMode           | string   | Режим работы API                                                          | sequential                                                               |
| apiWait           | number   | Время ожидания следующей попытки запроса после ошибки                     | 3000                                                                     |
| apiLimit          | number   | Количество запрос к API в секунду                                         | 3                                                                        |
| apiAttempts       | number   | Количество попыток повтора запроса после ошибки                           | 3                                                                        |
| apiTimeout        | number   | Время ожидания запроса                                                    | 6000                                                                     |
| apiHeaders        | Object   | Заголовки отправляемые вместе с запросом                                  | {'User-Agent':\`vk-io/${version} (+https://github.com/negezor/vk-io)\`}  |
| apiExecuteCount   | number   | Количество параллельных запросов при apiMode=(parallel|parallel_selected) | 25                                                                       |
| apiExecuteMethods | string[] | Методы которые будут собираться в execute при apiMode=parallel_selected   | ['messages.send']                                                        |

Доступные режимы работы API
- `sequential` - Все запросы идут последовательно
- `parallel` - Все запросы собираются пачкой по `apiExecuteCount` в метод `execute`
- `parallel_selected` - Выбранные методы собираются пачкой по `apiExecuteCount` в метод `execute`, остальные методы последовательно

### Опции загрузки

| Опция         | Тип    | Описание                        | По умолчанию |
|---------------|--------|---------------------------------|--------------|
| uploadTimeout | number | Время ожидания запроса загрузки | 15000        |

### Опции polling ([long poll](vk.com/dev/using_longpoll))

| Опция           | Тип    | Описание                                              | По умолчанию |
|-----------------|--------|-------------------------------------------------------|--------------|
| pollingWait     | number | Время ожидания следующей попытки запроса после ошибки | 3000         |
| pollingAttempts | number | Количество попыток повтора запроса после ошибки       | 3            |

### Опции webhook ([callback api](vk.com/dev/callback_api))

| Опция               | Тип    | Описание                                              | По умолчанию |
|---------------------|--------|-------------------------------------------------------|--------------|
| webhookPath         | string | Время ожидания следующей попытки запроса после ошибки | null         |
| webhookSecret       | string | Секретный ключ для проверки запросов                  | null         |
| webhookConfirmation | string | Строка подтверждения сервера                          | null         |

### Опции коллекций

| Опция           | Тип    | Описание                                        | По умолчанию |
|-----------------|--------|-------------------------------------------------|--------------|
| collectAttempts | number | Количество попыток повтора запроса после ошибки | 3            |

## setToken
Устанавливает токен

```js
vk.setToken(token); // => this
```

| Параметр | Тип    | Описание |
|----------|--------|----------|
| token    | string | Токен    |

## getToken
Возвращает токен

```js
vk.getToken(); // ?string
```

### setCaptchaHandler
Устанавливает обработчик капчи

```js
vk.setCaptchaHandler(handler); // => this
```

| Параметр | Тип      | Описание         |
|----------|----------|------------------|
| handler  | Function | Обработчик капчи |

```js
vk.setCaptchaHandler((payload, retry) => {...}); // => this
```

| Параметр | Тип      | Описание                       |
|----------|----------|--------------------------------|
| payload  | Object   | Полезная нагрузка              |
| retry    | Function | Повторяет запрос с кодом капчи |

Список возможных доступных свойств в `payload`

| Свойство | Тип      | Описание                 |
|----------|----------|--------------------------|
| sid      | number   | Идентификатор капчи      |
| src      | string   | URL на изображение капчи |
| request  | ?Request | Объект запроса           |

Пример использования

```js
vk.setCaptchaHandler(async ({ src }, retry) => {
	const key = await myAwesomeCaptchaHandler(src);

	try {
		await retry(key);

		console.log('Капча успешно решена');
	} catch (error) {
		console.log('Капча неверная');
	}
});
```

## setTwoFactorHandler
Устанавливает обработчик двух факторной защиты

```js
vk.setTwoFactorHandler(handler); // => this
```

| Параметр | Тип      | Описание                         |
|----------|----------|----------------------------------|
| handler  | Function | Обработчик двух факторной защиты |

```js
vk.setTwoFactorHandler((payload, retry) => {...});
```

| Параметр | Тип      | Описание                                       |
|----------|----------|------------------------------------------------|
| payload  | Object   | Полезная нагрузка                              |
| retry    | Function | Повторяет запрос с кодом двух факторной защиты |

Пример использования

```js
vk.setCaptchaHandler(async (payload, retry) => {
	const code = await getTwoFactorCode();

	try {
		await retry(code);

		console.log('Двух факторная авторизация пройдена');
	} catch (error) {
		console.log('Двух факторная авторизация провалилась');
	}
});
```
