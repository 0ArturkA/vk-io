# VK

```js
import VK from 'vk-io';
```

## Constructor
Инициализация новой инстанции VK
```js
new VK([options]);
```

Пример
```js
new VK({
	app: 1707
});
```

| Параметр | Тип    | Описание          |
|----------|--------|-------------------|
| options  | Object | [Опции](#options) |

## setOptions
Устанавливает опции

```js
vk.setOptions(options); // => this
```

| Параметр | Тип    | Описание          |
|----------|--------|-------------------|
| options  | Object | [Опции](#options) |

### Options
#### Общие опции

| Опция | Тип    | Описание                                                                 | По умолчанию |
|-------|--------|--------------------------------------------------------------------------|--------------|
| token | String | Токен                                                                    | null         |
| agent | Agent  | [HTTPS агент](https://nodejs.org/api/https.html#https_class_https_agent) | https.Agent  |
| lang  | String | Язык возвращаемых данных                                                 | null         |

Доступные языки возвращаемых данных
- `ru` - русский
- `ua` - украинский
- `be` - белорусский
- `en` - английский
- `es` - испанский
- `fi` - финский
- `de` - немецкий
- `it` - итальянский

#### Опции авторизации

| Опция    | Тип    | Описание                  | По умолчанию |
|----------|--------|---------------------------|--------------|
| login    | String | Логин (email)             | null         |
| phone    | String | Телефон                   | null         |
| password | String | Пароль                    | null         |
| app      | Number | Идентификатор приложения  | null         |
| key      | String | Секретный ключ приложения | null         |
| scope    | String | Доступ приложения         | all          |

#### Опции запросов к API

| Опция             | Тип      | Описание                                                                  | По умолчанию                                                             |
|-------------------|----------|---------------------------------------------------------------------------|--------------------------------------------------------------------------|
| apiMode           | String   | Режим работы API                                                          | sequential                                                               |
| apiWait           | Number   | Время ожидания следующей попытки запроса после ошибки                     | 3000                                                                     |
| apiLimit          | Number   | Количество запрос к API в секунду                                         | 3                                                                        |
| apiAttempts       | Number   | Количество попыток повтора запроса после ошибки                           | 3                                                                        |
| apiTimeout        | Number   | Время ожидания запроса                                                    | 6000                                                                     |
| apiHeaders        | Object   | Заголовки отправляемые вместе с запросом                                  | {'User-Agent':\`vk-io/${version} (+https://github.com/negezor/vk-io)\`}  |
| apiExecuteCount   | Number   | Количество параллельных запросов при apiMode=(parallel|parallel_selected) | 25                                                                       |
| apiExecuteMethods | String[] | Методы которые будут собираться в execute при apiMode=parallel_selected   | ['messages.send']                                                        |

Доступные режимы работы API
- `sequential` - Все запросы идут последовательно
- `parallel` - Все запросы собираются пачкой по `apiExecuteCount` в метод `execute`
- `parallel_selected` - Выбранные методы собираются пачкой по `apiExecuteCount` в метод `execute`, остальные методы последовательно

#### Опции загрузки

| Опция         | Тип    | Описание                        | По умолчанию |
|---------------|--------|---------------------------------|--------------|
| uploadTimeout | Number | Время ожидания запроса загрузки | 15000        |

#### Опции long poll

| Опция           | Тип    | Описание                                              | По умолчанию |
|-----------------|--------|-------------------------------------------------------|--------------|
| pollingWait     | Number | Время ожидания следующей попытки запроса после ошибки | 3000         |
| pollingAttempts | Number | Количество попыток повтора запроса после ошибки       | 3            |

#### Опции callback api

| Опция               | Тип    | Описание                                              | По умолчанию |
|---------------------|--------|-------------------------------------------------------|--------------|
| webhookPath         | String | Время ожидания следующей попытки запроса после ошибки | /            |
| webhookSecret       | String | Секретный ключ для проверки запрсов                   | null         |
| webhookConfirmation | String | Строка подтверждения сервера                          | null         |

#### Опции коллекций

| Опция           | Тип    | Описание                                        | По умолчанию |
|-----------------|--------|-------------------------------------------------|--------------|
| collectAttempts | Number | Количество попыток повтора запроса после ошибки | 3            |

### setToken
Устанавливает токен

```js
vk.setToken(token); // => this
```

| Параметр | Тип    | Описание |
|----------|--------|----------|
| token    | String | Токен    |

### getToken
Возвращает токен

```js
vk.getToken(); // ?String
```

### setCaptchaHandler
Устанавливает обработчик капчи

```js
vk.setCaptchaHandler(handler); // => this
```

| Параметр | Тип      | Описание         |
|----------|----------|------------------|
| handler  | Function | Обработчик капчи |

```js
vk.setCaptchaHandler((payload, retry) => {...});
```

| Параметр | Тип      | Описание                       |
|----------|----------|--------------------------------|
| payload  | Object   | Полезная нагрузка              |
| retry    | Function | Повторяет запрос с кодом капчи |

Список возможных доступных свойств в `payload`

| Свойство | Тип      | Описание                 |
|----------|----------|--------------------------|
| sid      | Number   | Идентификатор капчи      |
| src      | String   | URL на изображение капчи |
| request  | ?Request | Объект запроса           |

Пример использования

```js
vk.setCaptchaHandler(async ({ src }, retry) => {
	const key = await myAwesomeCaptchaHandler(src);

	try {
		await retry(key);

		console.log('Капча успешно решена');
	} catch (error) {
		console.log('Капча неверная');
	}
});
```

### setTwoFactorHandler
Устанавливает обработчик двухфакторной защиты

```js
vk.setTwoFactorHandler(handler); // => this
```

| Параметр | Тип      | Описание                        |
|----------|----------|---------------------------------|
| handler  | Function | Обработчик двухфакторной защиты |

```js
vk.setTwoFactorHandler((payload, retry) => {...});
```

| Параметр | Тип      | Описание                                      |
|----------|----------|-----------------------------------------------|
| payload  | Object   | Полезная нагрузка                             |
| retry    | Function | Повторяет запрос с кодом двухфакторной защиты |

Пример использования

```js
vk.setCaptchaHandler(async (payload, retry) => {
	const code = await getTwoFactorCode();

	try {
		await retry(code);

		console.log('Двухфакторная авторизация пройдена');
	} catch (error) {
		console.log('Двухфакторная авторизация провалилась');
	}
});
```
